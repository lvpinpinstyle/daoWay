<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>service-item</title>
    <link rel="stylesheet" href="./stylesheets/reset.css">
    <link rel="stylesheet" href="./css/service-item.css">

    <script type="text/javascript" src="./javascripts/jquery-1.10.1.js"></script>
    <script type="text/javascript" src="./javascripts/template-web.js"></script>
    <script src="https://cdn.bootcss.com/moment.js/2.21.0/moment.min.js"></script>

</head>
<body>
    <div class="serviceitem">
        <header id="header">
            <div class="headerleft">
                <a href="javascripts:;">
                    <img src="./images/main/logo.png">
                </a>
            </div>
            <div class="headermiddle">
                <a href="javascripts:;">
                    <img src="./images/main/citypoint.png">
                    <span>北京</span>
                    <span>切换城市</span>
                </a>
            </div>
            <ul class="headerright">
                <li class="rightitem">
                    <a href="http://localhost:3000/index.html">首页</a>
                </li>
                <li class="rightitem">
                    <a href="javascripts:;">到位APP</a>
                </li>
                <li class="rightitem on">
                    <a href="http://localhost:3000/service.html">服务商</a>
                </li>
                <li class="rightitem">
                    <a href="javascripts:;">商家入驻</a>
                </li>
                <li class="rightitem">
                    <a href="javascripts:;">风物APP</a>
                </li>
                <li class="rightitem">
                    <a href="javascripts:;">关于我们</a>
                </li>
                <li class="rightitem">
                    <a href="javascripts:;">商家登陆</a>
                </li>
            </ul>
        </header>
        <div class="headertitle">
            <div class="header-center">
               <!-- <div class="headerleft">
                    <span class="name">云家政</span>
                    <span class="timing">营业时间：</span>
                    <span class="time">08:00-22:00</span>
                    <span class="preorder">最近可预约时间：</span>
                    <span class="pretime">03月20日 11:30</span>
                </div>
                <div class="headerright">
                    <ul class="jiedan">
                        <li class="jiedanitem">
                            <div class="leftnumeber">
                                <span class="number">45536</span>
                                <span class="success">成功接单</span>
                            </div>

                            <div class="fenge">|</div>
                        </li>
                        <li class="jiedanitem">
                            <div class="leftnumeber">
                                <span class="number">45536</span>
                                <span class="success">成功接单</span>
                            </div>

                            <div class="fenge">|</div>
                        </li>
                        <li class="jiedanitem">
                            <div class="leftnumeber">
                                <span class="number">45536</span>
                                <span class="success">成gong</span>
                            </div>

                        </li>
                    </ul>
                </div>-->
            </div>
        </div>
        <div class="navtitle">
            <ul class="navs">
                <li class="nav">
                    <a href="javascripts:;">服务项目</a>
                </li>
                <li class="nav">
                    <a href="javascripts:;">商家简介</a>
                </li>
                <li class="nav">
                    <a href="javascripts:;">用户评论</a>
                </li>
            </ul>
        </div>
        <div class="content">
            <div class="contentleft">
                <div class="leftitem">
                    <div class="h3">
                        <h3>
                            <span class="seritem">服务项目</span>
                        </h3>
                    </div>
                    <div class="detailcontainer">
                        <!--<div class="detailwrap">
                            <a href="javascripts:;">
                                <div class="detail">
                                    <img class="image" src="./images/item1.jpg">
                                    <div class="wrap">
                                        <p class="detailtitle">家庭保洁</p>
                                        <p class="detaildescription">
                                            家庭保洁服务，2小时起订，服务时间未使用完不做退款处理。阿...
                                        </p>
                                        <p class="price">
                                            <span class="pricenumber">35<span class="hourprice">元/小时</span></span>
                                            <span class="initprice">原价 <span class="inithourprice">45</span></span>
                                        </p>
                                    </div>
                                    <div class="salecount">
                                        已售<span class="totalcount">59915</span>
                                    </div>
                                </div>
                            </a>
                        </div>-->
                    </div>
                    <div class="h4">
                        <h3>
                            <span class="seritem">商家简介</span>
                        </h3>
                    </div>
                    <div class="detail">
                       <!-- <div class="company">
                            <span>上海家谐网络科技有限公司</span>
                            <img src="./images/anquan.jpg" alt="">
                        </div>
                        <div class="descr">
                            云家政是家政服务在线预订平台。我们的目标是让每个家庭都能获得诚信、便捷、有保障的家政服务。云家政拥有国内最大的实名认证家庭服务员数据库，目前平台上有超过100000名专业服务人员；数百个家政服务商，遍布全国主要城市各个社区。
                            云家政倡导简单、轻松的生活方式。通过把分散的家政服务能力汇集和分配，让中国家庭获得诚信、便捷、有保障的家政服务，解决日常生活中的麻烦事，把更多时间留给自己和家人，提高生活品质。
                        </div>-->
                    </div>
                    <div class="h5">
                        <h3>
                            <span class="seritem">用户评论</span>
                            <span class="commentscount">(10380条评论)</span>
                        </h3>
                    </div>
                    <div class="commentslist">
                        <!--<div class="commentitem">
                            <img class="avatar" src="http://wx.qlogo.cn/mmopen/GtS5XXtiaCDYc0UGjnMohYQ83TxLhgk3vob0aN6sNYkTfoy4orpo0RmObrtOAVn2ZPRtoW31erDl3ZVsT4bIQGA/0" alt="">
                            <ul class="comms">
                                <li class="name">小伟</li>
                                <li class="ratings">
                                    <span class="star">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                    </span>
                                    <span class="time">2018-03-09</span>
                                </li>
                                <li class="details">准时到达</li>
                                <li class="address">
                                    <img src="./images/citypoint.png">
                                    <span class="city">北京<span>朝阳区</span></span>
                                </li>
                            </ul>
                        </div>
                        <div class="commentitem">
                            <img class="avatar" src="http://wx.qlogo.cn/mmopen/GtS5XXtiaCDYc0UGjnMohYQ83TxLhgk3vob0aN6sNYkTfoy4orpo0RmObrtOAVn2ZPRtoW31erDl3ZVsT4bIQGA/0" alt="">
                            <ul class="comms">
                                <li class="name">小伟</li>
                                <li class="ratings">
                                    <span class="star">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                    </span>
                                    <span class="time">2018-03-09</span>
                                </li>
                                <li class="details">准时到达</li>
                                <li class="address">
                                    <img src="./images/citypoint.png">
                                    <span class="city">北京<span>朝阳区</span></span>
                                </li>
                            </ul>
                        </div>
                        <div class="commentitem">
                            <img class="avatar" src="http://wx.qlogo.cn/mmopen/GtS5XXtiaCDYc0UGjnMohYQ83TxLhgk3vob0aN6sNYkTfoy4orpo0RmObrtOAVn2ZPRtoW31erDl3ZVsT4bIQGA/0" alt="">
                            <ul class="comms">
                                <li class="name">小伟</li>
                                <li class="ratings">
                                    <span class="star">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                    </span>
                                    <span class="time">2018-03-09</span>
                                </li>
                                <li class="details">准时到达</li>
                                <li class="address">
                                    <img src="./images/citypoint.png">
                                    <span class="city">北京<span>朝阳区</span></span>
                                </li>
                            </ul>
                        </div>
                        <div class="commentitem">
                            <img class="avatar" src="http://wx.qlogo.cn/mmopen/GtS5XXtiaCDYc0UGjnMohYQ83TxLhgk3vob0aN6sNYkTfoy4orpo0RmObrtOAVn2ZPRtoW31erDl3ZVsT4bIQGA/0" alt="">
                            <ul class="comms">
                                <li class="name">小伟</li>
                                <li class="ratings">
                                    <span class="star">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                        <img src="./images/red_star.png">
                                    </span>
                                    <span class="time">2018-03-09</span>
                                </li>
                                <li class="details">准时到达</li>
                                <li class="address">
                                    <img src="./images/citypoint.png">
                                    <span class="city">北京<span>朝阳区</span></span>
                                </li>
                            </ul>
                        </div>-->
                    </div>
                    <div class="fenye">
                        <a href="javascripts:;" class="prepage">< 上一页 </a>
                        <div class="pages" id="test">
                            <a href="javascripts:;" class="num on">1</a>
                            <a href="javascripts:;" class="num">2</a>
                            <a href="javascripts:;" class="num">3</a>
                            <span class="ss">...</span>
                            <a href="javascripts:;" class="num">4</a>
                            <a href="javascripts:;" class="num">5</a>
                            <a href="javascripts:;" class="num">6</a>
                            <a href="javascripts:;" class="num">7</a>
                            <a href="javascripts:;" class="num">8</a>
                            <a href="javascripts:;" class="num">9</a>
                            ...
                        </div>
                        <a href="javascripts:;" class="nextpage on">> 下一页 </a>
                    </div>
                </div>
            </div>
            <div class="contentright">
                <div class="bottom">
                <img class="image" src="./images/二维码.png" alt="">
            </div>
                <div class="bottom">
                    <img class="image" src="./images/二维码.png" alt="">
                </div>
            </div>
        </div>
        <div class="baozhang">
            <h2>到位<i>服务</i>保障</h2>
            <p>到位平台担保交易安全，交易未成功100%退款</p>
        </div>
        <div class="service">
            <div class="anquan">
                <img src="./images/anquan.jpg" alt="">
                <span>优选服务</span>
            </div>
            <div class="anquan">
                <img src="./images/anquan.jpg" alt="">
                <span>全程保障</span>
            </div>
            <div class="anquan">
                <img src="./images/anquan.jpg" alt="">
                <span>安全无忧</span>
            </div>
        </div>
        <div class="cities">
            <div class="city">热门城市</div>
            <div class="citieswrap">
                <ul class="citieslist">

                </ul>
            </div>
        </div>
        <div class="beian">©2015 版权所有 到位 daoway.com 京ICP备15001471号-1 北京邻家科技有限公司</div>
    </div>
</body>
<script type="text/html" id="temp5">
    <div class="headerleft">
        <span class="name">{{data.item.title}}</span>
        <span class="timing">营业时间：</span>
        <span class="time">08:00-22:00</span>
        <span class="preorder">最近可预约时间：</span>
        <span class="pretime">03月20日 11:30</span>
    </div>
    <div class="headerright">
        <ul class="jiedan">
            <li class="jiedanitem">
                <div class="leftnumeber">
                    <span class="number">{{data.item.orderCount}}</span>
                    <span class="success">成功接单</span>
                </div>
                <div class="fenge">|</div>
            </li>
            <li class="jiedanitem">
                <div class="leftnumeber">
                    <span class="number">{{data.item.accept}}</span>
                    <span class="success">接单率</span>
                </div>

                <div class="fenge">|</div>
            </li>
            <li class="jiedanitem">
                <div class="leftnumeber">
                    <span class="number">{{data.item.praise}}</span>
                    <span class="success">好评率</span>
                </div>

            </li>
        </ul>
    </div>
</script>

<script type="text/html" id="temp6">
    <div class="detailwrap">
        <a href="javascripts:;">
            <div class="detail">
                <img class="image" src="{{data.item.imgUrl}}" onclick="gotodetail()">
                <div class="wrap">
                    <p class="detailtitle">{{data.item.name}}</p>
                    <p class="detaildescription">
                        {{data.item.desc}}
                    </p>
                    <p class="price">
                        <span class="pricenumber">{{data.item.price}}<span class="hourprice">元/小时</span></span>
                        <span class="initprice">原价 <span class="inithourprice">{{data.item.oldPrice}}</span></span>
                    </p>
                </div>
                <div class="salecount">
                    已售<span class="totalcount">{{data.item.soldCount}}</span>
                </div>
            </div>
        </a>
    </div>
</script>
<script type="text/html" id="temp7">
    <div class="company">
        <span>{{data.item.company}}</span>
        <img src="./images/service/renzheng.jpg" alt="">
    </div>
    <div class="descr">
        {{data.item.profile}}
    </div>
</script>
<script type="text/html" id="temp8">
    {{each data.comments}}
    <div class="commentitem">
        <img class="{{$value.iconUrl}}" alt="">
        <ul class="comms">
            <li class="name">{{$value.nick}}</li>
            <li class="ratings">
                <span class="star">
                    {{each $value.starImgs}}
                    <img src="{{$value}}">
                    {{/each}}
                </span>
                <span class="time">{{$value.createtime | dateFormat 'YYYY-MM-DD'}}</span>
            </li>
            <li class="details">{{$value.comment}}</li>
            <li class="address">
                <img src="./images/citypoint.png">
                <span class="city">{{$value.city}}<span>{{$value.area}}</span></span>
            </li>
        </ul>
    </div>
    {{/each}}
</script>
<script type="text/html" id="temp9">
    {{each data.city}}
    <li class="cityitem">
        <a href="javascripts:;">{{$value.city}}</a>
    </li>
    {{/each}}
</script>
<script>
    var page=1
    //页面跳转
    function gotodetail() {
       window.location.href='/detail.html'
    }

    const pages=$('#test > a')

    //下一页三点显示
    function sandian(){
        if(page>6){
            for (var i = 0; i < page-2; i++) {
                $(pages[i]).hide()
            }
            for(var j=0;j<2;j++){
                $(pages[j]).show()
            }
            $('.pages>.ss').show()
        }else{
            for (var i = 0; i < 9; i++) {
                $(pages[i]).show()
                $('.pages>.ss').hide()
            }
        }
        console.log(page);
    }
    //上一页三点显示
    function nextsandian() {
        if(page>6 &&page<9){
            for(var i=0;i<page;i++){
                $(pages[i]).show()
            }
            for (var i = 0; i < page-2; i++) {
                $(pages[i]).hide()
            }
            for(var j=0;j<2;j++){
                $(pages[j]).show()
            }
            $(pages[page-1]).show()
            $('.pages>.ss').show()
        }else{
            for (var i = 0; i < 9; i++) {
                $(pages[i]).show()
                $('.pages>.ss').hide()
            }
        }
        console.log(page);
    }
    //点击谁谁显示三点
    function thissandian(){
        if(page>6){
            for(var i=0;i<page;i++){
                $(pages[i]).show()
            }
            for (var i = 0; i < page-3; i++) {
                $(pages[i]).hide()
            }
            for(var j=0;j<2;j++){
                $(pages[j]).show()
            }
            $('.pages>.ss').show()
        }else{
            for (var i = 0; i < 9; i++) {
                $(pages[i]).show()
                $('.pages>.ss').hide()
            }
        }
    }

    $(function(){

        //头部定位问题
        const $header=$('#header')
        $(document).scroll(function () {
            if($(this).scrollTop()>66){
                $header.addClass('on')
            }else{
                $header.removeClass('on')

            }
        })

        $.get('/getServiceItem?id=1001',function(data){
            $('.headertitle>.header-center').append(template('temp5',{data:data}))

            $('.detailcontainer').append(template('temp6',{data:data}))

            $('.contentleft>.detail').append(template('temp7',{data:data}))
        })
        $.get('/getCities', function (data) {
            $('.citieslist').html(template('temp9', {data: data}));
        })

        //设置星星图片数组
        function addStarImg(data) {
            for (var i = 0; i < data.comments.length; i++) {
                const starImgArr=[]
                var evrystar=data.comments[i].star
                
                for (var j = 0; j < evrystar; j++) {
                    starImgArr.push('./images/service/red_star.png')
                }

                while(starImgArr.length<5){
                    starImgArr.push('./images/service/gray_star.png')
                }
                //将星星数组放在comments的属性上
                data.comments[i].starImgs=starImgArr
            }
        }

        //设置时间格式
        function setTime(data) {
            for (var i = 0; i < data.comments.length; i++) {
                var time=data.comments[i].createtime
                template.defaults.imports.dateFormat = function(time, format){
                    return moment(time).format(format);
                }
        }


        }

        //获取第一页
        $.get('/getComments?page='+page, function (data) {
            addStarImg(data)
            setTime(data)
            $('.leftitem>.commentslist').html(template('temp8',{data:data}))
        })

        //上下页黑色样式
        function setBlack(page) {
            if(page<=1){
                console.log(1)
                $('.fenye>.prepage').removeClass('on')
                $('.fenye>.nextpage').addClass('on')
            }else if(page<9){
                $('.fenye>.prepage').addClass('on')
                $('.fenye>.nextpage').addClass('on')
            }else{
                $('.fenye>.prepage').addClass('on')
                $('.fenye>.nextpage').removeClass('on')
            }
        }
        //点哪页哪页显示
        pages.click(function () {
            page= pages.index(this)+1
            setBlack(page)
            thissandian()
           pages.attr('class','num')
            $(this).addClass('on')
            $.get('/getComments?page='+page, function (data) {
                addStarImg(data)
               console.log(page)
               $('.leftitem>.commentslist').html(template('temp8',{data:data}))
           })
        })

        //点上一页
        $('.fenye>.prepage').click(function () {
            page--
            if(page<=1){
                page=1
            }
            pages.attr('class','num')
            if(page>1){
                $(pages[page-1]).addClass('on')
            }
            if(page==1){
                $(pages[0]).addClass('on')
            }
            setBlack(page)
            nextsandian()
            console.log(page);
            $.get('/getComments?page='+page, function (data) {
                addStarImg(data)
                setTime(data)
                $('.leftitem>.commentslist').html(template('temp8',{data:data}))
            })
        })

        //点下一页
        $('.fenye>.nextpage').click(function () {
            page++
            pages.attr('class','num')
            if(page>=9){
                page=9
            }
            if(page<9){
                $(pages[page-1]).addClass('on')
            }
            if(page>=9){
                $(pages[8]).addClass('on')
            }
            console.log(page);
            setBlack(page)
            sandian()
            $.get('/getComments?page='+page, function (data) {
                addStarImg(data)
                setTime(data)
                $('.leftitem>.commentslist').html(template('temp8',{data:data}))
            })
        })

    })
    //分页ajax请求会返回一个page总页数，我们只能js动态的添加a分页标签
</script>
<script>
</script>
</html>